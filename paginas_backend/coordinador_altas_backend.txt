ARCHIVOS BACKEND PARA: COORDINADOR_ALTAS
================================================================================
Generado: 2025-12-18 12:44:17
================================================================================

/frontend/src/services/api.js:
--------------------------------------------------------------------------------
// frontend/src/services/api.js
const API_BASE_URL = 'http://localhost:3000/api';

class ApiService {
  static getToken() {
    return localStorage.getItem('token');
  }

  static getHeaders() {
    const token = this.getToken();
    const headers = {
      'Content-Type': 'application/json',
    };
    
    if (token) {
      headers['Authorization'] = `Bearer ${token}`;
    }
    
    return headers;
  }

  static async request(url, options = {}) {
    const { method = 'GET', data } = options;
    
    const config = {
      method,
      headers: this.getHeaders(),
      credentials: 'include' // Importante para cookies si las usas
    };
    
    if (data) {
      config.body = JSON.stringify(data);
    }
    
    try {
      const response = await fetch(`${API_BASE_URL}${url}`, config);
      return this.handleResponse(response);
    } catch (error) {
      console.error('Fetch error:', error);
      throw error;
    }
  }

  static async get(url) {
    return this.request(url);
  }

  static async post(url, data) {
    return this.request(url, { method: 'POST', data });
  }

  static async put(url, data) {
    return this.request(url, { method: 'PUT', data });
  }

  static async delete(url) {
    return this.request(url, { method: 'DELETE' });
  }

  static async handleResponse(response) {
      // Primero verificar si hay contenido
      if (response.status === 204 || response.status === 205) {
          return {};
      }
      
      const contentType = response.headers.get('content-type');
      
      // IMPORTANTE: Si es CSV, devolver como texto sin parsear como JSON
      if (contentType && contentType.includes('text/csv')) {
          const text = await response.text();
          
          if (!response.ok) {
              throw new Error(text || `HTTP error! status: ${response.status}`);
          }
          
          // Para CSV, devolvemos el texto directamente
          return text;
      }
      
      // Si no es CSV, verificar si es JSON
      if (!contentType || !contentType.includes('application/json')) {
          const text = await response.text();
          
          if (!response.ok) {
              throw new Error(text || `HTTP error! status: ${response.status}`);
          }
          
          // Intentar parsear como JSON si es posible
          try {
              return text ? JSON.parse(text) : {};
          } catch {
              return text;
          }
      }
      
      // Si es JSON, parsearlo normalmente
      const data = await response.json();
      
      if (!response.ok) {
          const errorMessage = data.message || data.error || `HTTP error! status: ${response.status}`;
          const error = new Error(errorMessage);
          error.status = response.status;
          error.data = data;
          throw error;
      }
      
      return data;
  }

  // Métodos específicos para el dashboard
  static async getDashboardCoordinador() {
    return this.get('/dashboard/coordinador');
  }

  static async getMetricasGlobales(periodo = 'mes') {
    return this.get(`/dashboard/metricas-globales?periodo=${periodo}`);
  }

  static async getEstadisticas() {
    return this.get('/estadisticas/generales');
  }

  // Método para obtener información del usuario actual
  static async getCurrentUser() {
    return this.get('/auth/me');
  }
}

export default ApiService;


/backend/src/db/db.sql:
--------------------------------------------------------------------------------
CREATE DATABASE IF NOT EXISTS psicogestion_db;
USE psicogestion_db;

CREATE TABLE fundaciones (
    id INT PRIMARY KEY AUTO_INCREMENT,
    nombre VARCHAR(255) NOT NULL UNIQUE,
    direccion TEXT,
    telefono VARCHAR(20),
    email VARCHAR(255),
    responsable VARCHAR(255),
    activo BOOLEAN DEFAULT TRUE,
    convenio_inicio DATE,
    convenio_fin DATE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    email VARCHAR(255) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    nombre VARCHAR(100) NOT NULL,
    apellido VARCHAR(100) NOT NULL,
    telefono VARCHAR(20),
    rol ENUM('coordinador', 'psicologo', 'becario') NOT NULL DEFAULT 'becario',
    especialidad VARCHAR(100),
    fundacion_id INT,
    activo BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (fundacion_id) REFERENCES fundaciones(id) ON DELETE SET NULL
);

CREATE TABLE pacientes (
    id INT PRIMARY KEY AUTO_INCREMENT,
    nombre VARCHAR(100) NOT NULL,
    apellido VARCHAR(100) NOT NULL,
    email VARCHAR(255),
    telefono VARCHAR(20),
    fecha_nacimiento DATE,
    genero ENUM('masculino', 'femenino', 'otro', 'prefiero_no_decir'),
    direccion TEXT,
    estado VARCHAR(50) DEFAULT 'activo',
    activo BOOLEAN DEFAULT TRUE,
    notas TEXT,
    fundacion_id INT,
    ultimo_no_aprobado DATE NULL DEFAULT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (fundacion_id) REFERENCES fundaciones(id) ON DELETE SET NULL,
    INDEX idx_activo (activo),
    INDEX idx_apellido_nombre (apellido, nombre),
    INDEX idx_ultimo_no_aprobado (ultimo_no_aprobado)
);

CREATE TABLE expedientes (
    id INT PRIMARY KEY AUTO_INCREMENT,
    paciente_id INT NOT NULL UNIQUE,
    psicologo_id INT,
    motivo_consulta TEXT,
    historia_personal TEXT,
    historia_familiar TEXT,
    antecedentes_medicos TEXT,
    antecedentes_psiquiatricos TEXT,
    diagnostico_presuntivo VARCHAR(500),
    diagnostico_definitivo VARCHAR(500),
    tratamiento_actual TEXT,
    medicamentos JSON,
    alergias TEXT,
    factores_riesgo JSON,
    redes_apoyo TEXT,
    emergencia_contacto VARCHAR(255),
    emergencia_telefono VARCHAR(20),
    consentimiento_informado BOOLEAN DEFAULT FALSE,
    fecha_consentimiento DATE,
    restricciones_acceso JSON,
    notas_confidenciales TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (paciente_id) REFERENCES pacientes(id) ON DELETE CASCADE,
    FOREIGN KEY (psicologo_id) REFERENCES users(id) ON DELETE SET NULL
);

CREATE TABLE asignaciones (
    id INT PRIMARY KEY AUTO_INCREMENT,
    paciente_id INT NOT NULL,
    psicologo_id INT NOT NULL,
    becario_id INT,
    fecha_inicio DATE NOT NULL DEFAULT (CURRENT_DATE),
    fecha_fin DATE,
    motivo_fin VARCHAR(255),
    estado ENUM('activa', 'finalizada', 'suspendida') DEFAULT 'activa',
    notas TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (paciente_id) REFERENCES pacientes(id) ON DELETE CASCADE,
    FOREIGN KEY (psicologo_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (becario_id) REFERENCES users(id) ON DELETE SET NULL,
    INDEX idx_paciente_estado (paciente_id, estado),
    INDEX idx_psicologo_estado (psicologo_id, estado),
    INDEX idx_becario (becario_id)
);

CREATE TABLE citas (
    id INT PRIMARY KEY AUTO_INCREMENT,
    paciente_id INT NOT NULL,
    psicologo_id INT,
    becario_id INT,
    fecha DATE NOT NULL,
    hora TIME NOT NULL,
    tipo_consulta ENUM('presencial', 'virtual') DEFAULT 'presencial',
    estado ENUM('programada', 'confirmada', 'completada', 'cancelada') DEFAULT 'programada',
    notas TEXT,
    motivo_cancelacion VARCHAR(255),
    duracion INT DEFAULT 50,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (paciente_id) REFERENCES pacientes(id) ON DELETE CASCADE,
    FOREIGN KEY (psicologo_id) REFERENCES users(id) ON DELETE SET NULL,
    FOREIGN KEY (becario_id) REFERENCES users(id) ON DELETE SET NULL,
    INDEX idx_fecha_estado (fecha, estado),
    INDEX idx_psicologo_fecha (psicologo_id, fecha),
    INDEX idx_becario (becario_id),
    INDEX idx_paciente_id (paciente_id)
);

CREATE TABLE sesiones (
    id INT PRIMARY KEY AUTO_INCREMENT,
    cita_id INT NOT NULL UNIQUE,
    psicologo_id INT NOT NULL,
    fecha DATE NOT NULL,
    hora_inicio TIME NOT NULL,
    hora_fin TIME NOT NULL,
    tipo_sesion ENUM('evaluacion', 'terapia', 'seguimiento', 'crisis') DEFAULT 'terapia',
    objetivo TEXT,
    desarrollo TEXT,
    conclusion TEXT,
    tareas_asignadas TEXT,
    emocion_predominante VARCHAR(100),
    riesgo_suicida ENUM('ninguno', 'bajo', 'moderado', 'alto') DEFAULT 'ninguno',
    escalas_aplicadas JSON,
    siguiente_cita DATE,
    privado BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (cita_id) REFERENCES citas(id) ON DELETE CASCADE,
    FOREIGN KEY (psicologo_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_cita_id (cita_id),
    INDEX idx_psicologo_fecha (psicologo_id, fecha),
    INDEX idx_fecha (fecha)
);

CREATE TABLE notificaciones (
    id INT PRIMARY KEY AUTO_INCREMENT,
    usuario_id INT NOT NULL,
    tipo ENUM('cita_programada', 'cita_modificada', 'cita_cancelada', 'asignacion_nueva', 'observacion_nueva', 'alerta_sistema', 'reporte_generado') NOT NULL,
    titulo VARCHAR(255) NOT NULL,
    mensaje TEXT NOT NULL,
    leido BOOLEAN DEFAULT FALSE,
    leido_at TIMESTAMP NULL,
    accion_url VARCHAR(500),
    prioridad ENUM('baja', 'media', 'alta', 'urgente') DEFAULT 'media',
    datos_extra JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (usuario_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_usuario_leido (usuario_id, leido),
    INDEX idx_created_at (created_at),
    INDEX idx_tipo (tipo)
);

CREATE TABLE altas (
    id INT PRIMARY KEY AUTO_INCREMENT,
    paciente_id INT NOT NULL,
    usuario_id INT NOT NULL,
    tipo_alta ENUM('terapeutica', 'abandono', 'traslado', 'graduacion', 'no_continua', 'otro', 'no_aprobado') NOT NULL,
    fecha_alta DATE NOT NULL DEFAULT (CURRENT_DATE),
    motivo_detallado TEXT,
    recomendaciones TEXT,
    sesiones_totales INT,
    evaluacion_final ENUM('excelente', 'buena', 'regular', 'mala'),
    seguimiento_recomendado BOOLEAN DEFAULT FALSE,
    fecha_seguimiento DATE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (paciente_id) REFERENCES pacientes(id) ON DELETE CASCADE,
    FOREIGN KEY (usuario_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_paciente_id (paciente_id),
    INDEX idx_fecha_alta (fecha_alta),
    INDEX idx_tipo_alta (tipo_alta)
);

CREATE TABLE reportes (
    id INT PRIMARY KEY AUTO_INCREMENT,
    usuario_id INT NOT NULL,
    tipo_reporte ENUM('mensual', 'trimestral', 'semestral', 'anual', 'personalizado', 'paciente', 'becario', 'psicologo') NOT NULL,
    nombre VARCHAR(255) NOT NULL,
    descripcion TEXT,
    parametros JSON,
    fecha_inicio DATE,
    fecha_fin DATE,
    formato ENUM('pdf', 'excel', 'csv', 'html') DEFAULT 'pdf',
    archivo_url VARCHAR(500),
    archivo_tamano INT,
    estado ENUM('pendiente', 'generando', 'completado', 'error') DEFAULT 'pendiente',
    compartido_con JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (usuario_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_usuario_id (usuario_id),
    INDEX idx_tipo_reporte_estado (tipo_reporte, estado),
    INDEX idx_created_at (created_at)
);

CREATE TABLE observaciones_becarios (
    id INT PRIMARY KEY AUTO_INCREMENT,
    becario_id INT NOT NULL,
    supervisor_id INT NOT NULL,
    cita_id INT,
    fecha DATE NOT NULL DEFAULT (CURRENT_DATE),
    tipo_observacion ENUM('sesion_observada', 'retroalimentacion', 'evaluacion_periodica', 'incidencia', 'reconocimiento') DEFAULT 'sesion_observada',
    aspecto_evaluado ENUM('empatia', 'tecnicas', 'documentacion', 'puntualidad', 'profesionalismo', 'etica') NOT NULL,
    calificacion INT NOT NULL CHECK (calificacion BETWEEN 1 AND 10),
    fortalezas TEXT,
    areas_mejora TEXT,
    recomendaciones TEXT,
    plan_accion TEXT,
    fecha_seguimiento DATE,
    privada BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (becario_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (supervisor_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (cita_id) REFERENCES citas(id) ON DELETE SET NULL,
    INDEX idx_becario_fecha (becario_id, fecha),
    INDEX idx_supervisor (supervisor_id),
    INDEX idx_tipo_observacion (tipo_observacion)
);

CREATE TABLE disponibilidades (
    id INT PRIMARY KEY AUTO_INCREMENT,
    usuario_id INT NOT NULL,
    dia_semana ENUM('lunes', 'martes', 'miercoles', 'jueves', 'viernes', 'sabado', 'domingo') NOT NULL,
    hora_inicio TIME NOT NULL,
    hora_fin TIME NOT NULL,
    tipo_disponibilidad ENUM('regular', 'extraordinaria', 'limitada') DEFAULT 'regular',
    activo BOOLEAN DEFAULT TRUE,
    fecha_inicio_vigencia DATE NOT NULL DEFAULT (CURRENT_DATE),
    fecha_fin_vigencia DATE,
    notas TEXT,
    max_citas_dia INT DEFAULT 8,
    intervalo_citas INT DEFAULT 50,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (usuario_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_usuario_dia_activo (usuario_id, dia_semana, activo),
    INDEX idx_fecha_vigencia (fecha_inicio_vigencia, fecha_fin_vigencia)
);

CREATE TABLE logs_sistema (
    id INT PRIMARY KEY AUTO_INCREMENT,
    usuario_id INT,
    tipo_log ENUM('login', 'logout', 'creacion', 'modificacion', 'eliminacion', 'error', 'seguridad', 'backup', 'reporte', 'sistema') NOT NULL,
    modulo VARCHAR(100) NOT NULL,
    accion VARCHAR(255) NOT NULL,
    descripcion TEXT,
    datos_antes JSON,
    datos_despues JSON,
    ip_address VARCHAR(45),
    user_agent TEXT,
    severidad ENUM('info', 'advertencia', 'error', 'critico') DEFAULT 'info',
    resuelto BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (usuario_id) REFERENCES users(id) ON DELETE SET NULL,
    INDEX idx_tipo_log_fecha (tipo_log, created_at),
    INDEX idx_usuario_id (usuario_id),
    INDEX idx_modulo (modulo),
    INDEX idx_severidad_resuelto (severidad, resuelto)
);

CREATE TABLE permisos (
    id INT PRIMARY KEY AUTO_INCREMENT,
    nombre VARCHAR(100) NOT NULL UNIQUE,
    descripcion TEXT,
    categoria ENUM('administracion', 'pacientes', 'citas', 'reportes', 'configuracion', 'usuarios') NOT NULL,
    nivel_requerido ENUM('basico', 'intermedio', 'avanzado', 'administrador') DEFAULT 'basico',
    activo BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE usuario_permisos (
    id INT PRIMARY KEY AUTO_INCREMENT,
    usuario_id INT NOT NULL,
    permiso_id INT NOT NULL,
    concedido BOOLEAN DEFAULT FALSE,
    concedido_por INT,
    fecha_concesion TIMESTAMP NULL,
    fecha_expiracion TIMESTAMP NULL,
    motivo TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (usuario_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (permiso_id) REFERENCES permisos(id) ON DELETE CASCADE,
    FOREIGN KEY (concedido_por) REFERENCES users(id) ON DELETE SET NULL,
    UNIQUE KEY idx_usuario_permiso (usuario_id, permiso_id)
);

CREATE TABLE backups (
    id INT PRIMARY KEY AUTO_INCREMENT,
    tipo ENUM('completo', 'incremental') NOT NULL,
    ruta VARCHAR(500) NOT NULL,
    tamano BIGINT,
    base_backup_id INT,
    cambios INT DEFAULT 0,
    estado ENUM('pendiente', 'generando', 'completado', 'error', 'eliminado') DEFAULT 'pendiente',
    ultima_restauracion TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (base_backup_id) REFERENCES backups(id) ON DELETE SET NULL
);

INSERT INTO permisos (nombre, descripcion, categoria, nivel_requerido) VALUES
('ver_panel_coordinacion', 'Ver panel de coordinación', 'administracion', 'avanzado'),
('gestionar_usuarios', 'Gestionar usuarios (alta/baja/edición)', 'usuarios', 'avanzado'),
('gestionar_fundaciones', 'Gestionar fundaciones', 'administracion', 'avanzado'),
('gestionar_pacientes', 'Gestionar pacientes', 'pacientes', 'intermedio'),
('gestionar_asignaciones', 'Asignar pacientes a psicólogos/becarios', 'pacientes', 'intermedio'),
('ver_agenda_global', 'Ver agenda global completa', 'citas', 'intermedio'),
('generar_reportes', 'Generar reportes estadísticos', 'reportes', 'avanzado'),
('gestionar_altas', 'Gestionar altas de pacientes', 'pacientes', 'intermedio'),
('ver_expedientes_completos', 'Ver expedientes completos de pacientes', 'pacientes', 'avanzado'),
('configurar_sistema', 'Configurar parámetros del sistema', 'configuracion', 'administrador'),
('ver_panel_psicologo', 'Ver panel principal de psicólogo', 'administracion', 'basico'),
('ver_mis_pacientes', 'Ver pacientes asignados', 'pacientes', 'basico'),
('gestionar_mis_citas', 'Gestionar mis propias citas', 'citas', 'basico'),
('registrar_sesiones', 'Registrar contenido de sesiones', 'citas', 'intermedio'),
('supervisar_becarios', 'Supervisar becarios asignados', 'usuarios', 'intermedio'),
('crear_observaciones', 'Crear observaciones de becarios', 'usuarios', 'intermedio'),
('ver_expedientes_asignados', 'Ver expedientes de pacientes asignados', 'pacientes', 'intermedio'),
('dar_altas_pacientes', 'Dar de alta a pacientes', 'pacientes', 'intermedio'),
('ver_panel_becario', 'Ver panel principal de becario', 'administracion', 'basico'),
('ver_citas_dia', 'Ver citas del día', 'citas', 'basico'),
('gestionar_citas_asignadas', 'Gestionar citas asignadas', 'citas', 'basico'),
('ver_pacientes_asignados', 'Ver pacientes asignados', 'pacientes', 'basico'),
('ver_observaciones_propias', 'Ver observaciones propias', 'usuarios', 'basico'),
('configurar_disponibilidad', 'Configurar disponibilidad personal', 'configuracion', 'basico');

INSERT INTO fundaciones (nombre, telefono, email, responsable) VALUES
('Fundación Salud Mental Comunitaria', '555-1234', 'contacto@fsmc.org', 'Dra. María González'),
('Asociación de Psicología Aplicada', '555-5678', 'info@asocpsicologia.edu', 'Lic. Carlos Rodríguez');

INSERT INTO users (email, password, nombre, apellido, telefono, rol, especialidad, fundacion_id) VALUES
('coordinador@psicogestion.com', '$2b$12$hae1TqJNVYIumXT7aPXKCO/lVf418E5.nXUCem30mFsG5itFuLDjq', 'Ana', 'Martínez', '555-1111', 'coordinador', 'Coordinación Clínica', 1),
('psicologo1@psicogestion.com', '$2b$12$hae1TqJNVYIumXT7aPXKCO/lVf418E5.nXUCem30mFsG5itFuLDjq', 'Luis', 'Fernández', '555-2222', 'psicologo', 'Terapia Cognitivo-Conductual', 1),
('becario1@psicogestion.com', '$2b$12$hae1TqJNVYIumXT7aPXKCO/lVf418E5.nXUCem30mFsG5itFuLDjq', 'Juan', 'Pérez', '555-3333', 'becario', 'Practicante de Psicología', 1),
('becario2@psicogestion.com', '$2b$12$hae1TqJNVYIumXT7aPXKCO/lVf418E5.nXUCem30mFsG5itFuLDjq', 'Sofía', 'Ramírez', '555-4444', 'becario', 'Practicante de Psicología', 2),
('psicologo2@psicogestion.com', '$2b$12$hae1TqJNVYIumXT7aPXKCO/lVf418E5.nXUCem30mFsG5itFuLDjq', 'Laura', 'Gutiérrez', '555-5555', 'psicologo', 'Terapia Familiar', 1),
('becario3@psicogestion.com', '$2b$12$hae1TqJNVYIumXT7aPXKCO/lVf418E5.nXUCem30mFsG5itFuLDjq', 'Pedro', 'Hernández', '555-6666', 'becario', 'Practicante de Psicología', 1);

INSERT INTO pacientes (nombre, apellido, fecha_nacimiento, genero, telefono, email) VALUES 
('Carlos', 'Gómez', '1998-05-15', 'masculino', '555-0011', 'carlos@gmail.com'),
('Mariana', 'López', '1995-08-22', 'femenino', '555-0022', 'mariana@hotmail.com'),
('Roberto', 'Sánchez', '2000-02-10', 'masculino', '555-0033', 'roberto@yahoo.com');

INSERT INTO expedientes (paciente_id, psicologo_id, motivo_consulta) VALUES
(1, 2, 'Ansiedad académica con síntomas de estrés elevado'),
(2, 2, 'Estrés laboral crónico con afectación del sueño'),
(3, 2, 'Dificultades de adaptación al entorno universitario');

INSERT INTO asignaciones (paciente_id, psicologo_id, becario_id, fecha_inicio) VALUES
(1, 2, 3, CURDATE()),
(2, 2, 4, CURDATE()),
(3, 2, NULL, CURDATE());

INSERT INTO citas (paciente_id, psicologo_id, becario_id, fecha, hora, estado, tipo_consulta, notas) VALUES
(1, 2, 3, DATE_ADD(CURDATE(), INTERVAL 1 DAY), '10:00:00', 'programada', 'presencial', 'Primera consulta'),
(2, 2, 4, DATE_ADD(CURDATE(), INTERVAL 2 DAY), '11:00:00', 'confirmada', 'virtual', 'Seguimiento'),
(3, 2, NULL, DATE_ADD(CURDATE(), INTERVAL 3 DAY), '09:00:00', 'programada', 'presencial', 'Evaluación inicial');

INSERT INTO notificaciones (usuario_id, tipo, titulo, mensaje) VALUES
(3, 'cita_programada', 'Nueva cita asignada', 'Tienes una nueva cita con Carlos Gómez para mañana a las 10:00 AM'),
(4, 'cita_modificada', 'Cita modificada', 'La cita con Mariana López ha sido cambiada a modalidad virtual');

INSERT INTO usuario_permisos (usuario_id, permiso_id, concedido, concedido_por, fecha_concesion)
SELECT u.id, p.id, TRUE, 1, NOW()
FROM users u
CROSS JOIN permisos p
WHERE u.rol = 'coordinador'
AND p.nivel_requerido IN ('basico', 'intermedio', 'avanzado', 'administrador');

INSERT INTO usuario_permisos (usuario_id, permiso_id, concedido, concedido_por, fecha_concesion)
SELECT u.id, p.id, TRUE, 1, NOW()
FROM users u
CROSS JOIN permisos p
WHERE u.rol = 'psicologo'
AND p.nivel_requerido IN ('basico', 'intermedio');

INSERT INTO usuario_permisos (usuario_id, permiso_id, concedido, concedido_por, fecha_concesion)
SELECT u.id, p.id, TRUE, 1, NOW()
FROM users u
CROSS JOIN permisos p
WHERE u.rol = 'becario'
AND p.nivel_requerido = 'basico';

CREATE VIEW vista_citas_hoy AS
SELECT 
    c.id,
    CONCAT(p.nombre, ' ', p.apellido) AS paciente,
    c.fecha,
    TIME_FORMAT(c.hora, '%H:%i') AS hora,
    c.estado,
    c.tipo_consulta,
    u_psi.nombre AS psicologo_nombre,
    u_bec.nombre AS becario_nombre
FROM citas c
JOIN pacientes p ON c.paciente_id = p.id
JOIN users u_psi ON c.psicologo_id = u_psi.id
LEFT JOIN users u_bec ON c.becario_id = u_bec.id
WHERE c.fecha = CURDATE()
AND c.estado IN ('programada', 'confirmada')
ORDER BY c.hora;

CREATE VIEW vista_pacientes_asignados AS
SELECT 
    a.id,
    CONCAT(p.nombre, ' ', p.apellido) AS paciente,
    p.telefono,
    p.email,
    CONCAT(u.nombre, ' ', u.apellido) AS psicologo,
    CONCAT(ub.nombre, ' ', ub.apellido) AS becario,
    a.fecha_inicio,
    a.estado AS estado_asignacion,
    (SELECT COUNT(*) FROM citas WHERE paciente_id = p.id AND estado = 'completada') AS sesiones_completadas,
    (SELECT COUNT(*) FROM citas WHERE paciente_id = p.id AND estado IN ('programada', 'confirmada') AND fecha >= CURDATE()) AS citas_pendientes
FROM asignaciones a
JOIN pacientes p ON a.paciente_id = p.id
JOIN users u ON a.psicologo_id = u.id
LEFT JOIN users ub ON a.becario_id = ub.id
WHERE p.activo = TRUE AND a.estado = 'activa';

CREATE VIEW vista_resumen_coordinacion AS
SELECT 
    (SELECT COUNT(*) FROM users WHERE rol = 'becario' AND activo = TRUE) AS becarios_activos,
    (SELECT COUNT(*) FROM users WHERE rol = 'psicologo' AND activo = TRUE) AS psicologos_activos,
    (SELECT COUNT(*) FROM pacientes WHERE activo = TRUE) AS pacientes_activos,
    (SELECT COUNT(*) FROM citas WHERE fecha = CURDATE() AND estado IN ('programada', 'confirmada')) AS citas_hoy,
    (SELECT COUNT(*) FROM citas WHERE fecha = CURDATE() AND estado = 'completada') AS citas_completadas_hoy,
    (SELECT COUNT(*) FROM altas WHERE MONTH(fecha_alta) = MONTH(CURDATE())) AS altas_mes_actual;

CREATE VIEW vista_historial_sesiones AS
SELECT 
    s.id,
    s.fecha,
    CONCAT(p.nombre, ' ', p.apellido) AS paciente,
    CONCAT(u.nombre, ' ', u.apellido) AS psicologo,
    s.desarrollo AS contenido_sesion,
    s.conclusion AS observaciones,
    s.tareas_asignadas,
    s.siguiente_cita AS proxima_sesion
FROM sesiones s
JOIN citas c ON s.cita_id = c.id
JOIN pacientes p ON c.paciente_id = p.id
JOIN users u ON s.psicologo_id = u.id
ORDER BY s.fecha DESC;

CREATE VIEW vista_estadisticas_psicologos AS
SELECT 
    u.id,
    CONCAT(u.nombre, ' ', u.apellido) AS psicologo,
    COUNT(DISTINCT a.paciente_id) AS pacientes_asignados,
    COUNT(c.id) AS total_citas,
    SUM(CASE WHEN c.estado = 'completada' THEN 1 ELSE 0 END) AS citas_completadas,
    ROUND(AVG(CASE WHEN c.estado = 'completada' THEN c.duracion END), 1) AS duracion_promedio,
    COUNT(DISTINCT a.becario_id) AS becarios_supervisados
FROM users u
LEFT JOIN asignaciones a ON u.id = a.psicologo_id AND a.estado = 'activa'
LEFT JOIN citas c ON u.id = c.psicologo_id AND c.fecha >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)
WHERE u.rol = 'psicologo' AND u.activo = TRUE
GROUP BY u.id, u.nombre, u.apellido;

CREATE VIEW vista_disponibilidad_semanal AS
SELECT 
    u.id,
    CONCAT(u.nombre, ' ', u.apellido) AS profesional,
    u.rol,
    d.dia_semana,
    TIME_FORMAT(d.hora_inicio, '%H:%i') AS hora_inicio,
    TIME_FORMAT(d.hora_fin, '%H:%i') AS hora_fin,
    d.max_citas_dia,
    (SELECT COUNT(*) FROM citas c 
     WHERE (c.psicologo_id = u.id OR c.becario_id = u.id)
     AND c.fecha = CURDATE()
     AND c.estado IN ('programada', 'confirmada')) AS citas_hoy
FROM users u
LEFT JOIN disponibilidades d ON u.id = d.usuario_id AND d.activo = TRUE
WHERE u.rol IN ('psicologo', 'becario') AND u.activo = TRUE
ORDER BY u.rol, u.apellido, FIELD(d.dia_semana, 'lunes', 'martes', 'miercoles', 'jueves', 'viernes', 'sabado', 'domingo');

DELIMITER $$
CREATE PROCEDURE sp_obtener_citas_por_fecha_becario(
    IN p_fecha DATE,
    IN p_becario_id INT
)
BEGIN
    SELECT 
        c.*,
        CONCAT(p.nombre, ' ', p.apellido) AS paciente_nombre,
        p.telefono AS paciente_telefono,
        p.email AS paciente_email,
        u_psi.nombre AS psicologo_nombre,
        u_bec.nombre AS becario_nombre,
        c.duracion AS duracion_minutos,
        c.notas AS motivo
    FROM citas c
    JOIN pacientes p ON c.paciente_id = p.id
    LEFT JOIN users u_psi ON c.psicologo_id = u_psi.id
    LEFT JOIN users u_bec ON c.becario_id = u_bec.id
    WHERE c.fecha = p_fecha
    AND (c.becario_id = p_becario_id OR p_becario_id IS NULL)
    ORDER BY c.hora;
END$$
DELIMITER ;

DELIMITER $$
CREATE PROCEDURE sp_generar_reporte_mensual(
    IN p_mes INT,
    IN p_anio INT,
    IN p_psicologo_id INT
)
BEGIN
    SELECT 
        p.id,
        CONCAT(p.nombre, ' ', p.apellido) AS paciente,
        COUNT(c.id) AS total_sesiones,
        SUM(CASE WHEN c.estado = 'completada' THEN 1 ELSE 0 END) AS sesiones_completadas,
        SUM(CASE WHEN c.estado = 'cancelada' THEN 1 ELSE 0 END) AS sesiones_canceladas,
        SUM(CASE WHEN c.estado = 'programada' THEN 1 ELSE 0 END) AS sesiones_programadas,
        MIN(c.fecha) AS primera_sesion_mes,
        MAX(c.fecha) AS ultima_sesion_mes
    FROM pacientes p
    LEFT JOIN citas c ON p.id = c.paciente_id 
        AND MONTH(c.fecha) = p_mes 
        AND YEAR(c.fecha) = p_anio
        AND (c.psicologo_id = p_psicologo_id OR p_psicologo_id IS NULL)
    WHERE p.activo = TRUE
    GROUP BY p.id, p.nombre, p.apellido
    ORDER BY p.apellido, p.nombre;
END$$
DELIMITER ;

DELIMITER $$
CREATE TRIGGER tr_after_insert_alta
AFTER INSERT ON altas
FOR EACH ROW
BEGIN
    UPDATE pacientes 
    SET estado = CONCAT('alta_', NEW.tipo_alta),
        activo = FALSE,
        updated_at = NOW()
    WHERE id = NEW.paciente_id;
    
    UPDATE citas 
    SET estado = 'cancelada',
        motivo_cancelacion = CONCAT('Paciente dado de alta (', NEW.tipo_alta, ')'),
        updated_at = NOW()
    WHERE paciente_id = NEW.paciente_id 
    AND fecha >= CURDATE()
    AND estado IN ('programada', 'confirmada');
    
    UPDATE asignaciones 
    SET estado = 'finalizada',
        fecha_fin = CURDATE(),
        motivo_fin = CONCAT('Paciente dado de alta (', NEW.tipo_alta, ')')
    WHERE paciente_id = NEW.paciente_id 
    AND estado = 'activa';
END$$
DELIMITER ;

DELIMITER $$
CREATE TRIGGER tr_after_update_cita
AFTER UPDATE ON citas
FOR EACH ROW
BEGIN
    DECLARE paciente_nombre VARCHAR(200);
    DECLARE paciente_email VARCHAR(255);
    
    IF OLD.fecha != NEW.fecha OR OLD.hora != NEW.hora OR OLD.tipo_consulta != NEW.tipo_consulta THEN
        
        SELECT CONCAT(nombre, ' ', apellido), email INTO paciente_nombre, paciente_email
        FROM pacientes WHERE id = NEW.paciente_id;
        
        IF NEW.psicologo_id IS NOT NULL THEN
            INSERT INTO notificaciones (usuario_id, tipo, titulo, mensaje, created_at)
            VALUES (
                NEW.psicologo_id,
                'cita_modificada',
                'Cita modificada',
                CONCAT('La cita con ', paciente_nombre, ' ha sido modificada. Nueva fecha: ', NEW.fecha, ' ', TIME_FORMAT(NEW.hora, '%H:%i')),
                NOW()
            );
        END IF;
        
        IF NEW.becario_id IS NOT NULL THEN
            INSERT INTO notificaciones (usuario_id, tipo, titulo, mensaje, created_at)
            VALUES (
                NEW.becario_id,
                'cita_modificada',
                'Cita modificada',
                CONCAT('La cita con ', paciente_nombre, ' ha sido modificada. Nueva fecha: ', NEW.fecha, ' ', TIME_FORMAT(NEW.hora, '%H:%i')),
                NOW()
            );
        END IF;
        
        INSERT INTO logs_sistema (usuario_id, tipo_log, modulo, accion, descripcion, created_at)
        VALUES (
            NEW.psicologo_id,
            'modificacion',
            'citas',
            'Actualizar cita',
            CONCAT('Cita ', NEW.id, ' modificada para paciente ', paciente_nombre),
            NOW()
        );
    END IF;
END$$
DELIMITER ;

DELIMITER $$
CREATE TRIGGER tr_after_insert_sesion
AFTER INSERT ON sesiones
FOR EACH ROW
BEGIN
    UPDATE expedientes 
    SET riesgo_suicida = NEW.riesgo_suicida,
        updated_at = NOW()
    WHERE paciente_id = (SELECT paciente_id FROM citas WHERE id = NEW.cita_id);
END$$
DELIMITER ;

CREATE INDEX idx_pacientes_activo ON pacientes(activo);
CREATE INDEX idx_citas_psicologo_fecha ON citas(psicologo_id, fecha, estado);
CREATE INDEX idx_sesiones_cita ON sesiones(cita_id);
CREATE INDEX idx_asignaciones_psicologo ON asignaciones(psicologo_id, fecha_fin);
CREATE INDEX idx_users_rol_activo ON users(rol, activo);
CREATE INDEX idx_expediente_paciente ON expedientes(paciente_id);
CREATE INDEX idx_expediente_psicologo ON expedientes(psicologo_id);
CREATE INDEX idx_reportes_usuario ON reportes(usuario_id, estado);
CREATE INDEX idx_reportes_tipo ON reportes(tipo_reporte, created_at);
CREATE INDEX idx_disponibilidades_vigencia ON disponibilidades(fecha_inicio_vigencia, fecha_fin_vigencia);
CREATE INDEX idx_logs_severidad ON logs_sistema(severidad, resuelto);
CREATE INDEX idx_observaciones_fecha_seguimiento ON observaciones_becarios(fecha_seguimiento);

CREATE USER IF NOT EXISTS 'psicogestion_user'@'localhost' IDENTIFIED BY 'SecurePass123!';
GRANT ALL PRIVILEGES ON psicogestion_db.* TO 'psicogestion_user'@'localhost';
GRANT EXECUTE ON PROCEDURE psicogestion_db.sp_obtener_citas_por_fecha_becario TO 'psicogestion_user'@'localhost';
GRANT EXECUTE ON PROCEDURE psicogestion_db.sp_generar_reporte_mensual TO 'psicogestion_user'@'localhost';
FLUSH PRIVILEGES;


/backend/src/services/api.js:
--------------------------------------------------------------------------------
const API_BASE_URL = 'http://localhost:3000/api';

class ApiService {
  static getToken() {
    return localStorage.getItem('token');
  }

  static getHeaders() {
    const token = this.getToken();
    return {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json',
    };
  }

  static async get(url) {
    const response = await fetch(`${API_BASE_URL}${url}`, {
      headers: this.getHeaders(),
    });
    return this.handleResponse(response);
  }

  static async post(url, data) {
    const response = await fetch(`${API_BASE_URL}${url}`, {
      method: 'POST',
      headers: this.getHeaders(),
      body: JSON.stringify(data),
    });
    return this.handleResponse(response);
  }

  static async put(url, data) {
    const response = await fetch(`${API_BASE_URL}${url}`, {
      method: 'PUT',
      headers: this.getHeaders(),
      body: JSON.stringify(data),
    });
    return this.handleResponse(response);
  }

  static async delete(url) {
    const response = await fetch(`${API_BASE_URL}${url}`, {
      method: 'DELETE',
      headers: this.getHeaders(),
    });
    return this.handleResponse(response);
  }

  static async handleResponse(response) {
    if (!response.ok) {
      const error = await response.json();
      throw new Error(error.message || 'Error en la petición');
    }
    return response.json();
  }
  static async getDashboardCoordinador() {
    return this.get('/dashboard/coordinador');
  }

  static async getMetricasGlobales(periodo = 'mes') {
    return this.get(`/dashboard/metricas-globales?periodo=${periodo}`);
  }

  static async getEstadisticas() {
    return this.get('/estadisticas/generales');
  }
}

export default ApiService;


/frontend/src/global.css:
--------------------------------------------------------------------------------
:root {
  /* Colores base - Manteniendo nombres originales */
  --grnb: #29ce6e;   /* Verde azulado oscuro */
  --blub: #2c3138;   /* Azul claro */
  --blud: #1B1E23;   /* Azul oscuro */
  --white: #ffffff;
  --grayl: #96a2ad;
  --gray: #6c757d;
  --gray-dark: #343a40;

  --whiteSET: #ffffff;
  --bludSET: #1B1E23;
  --blubSET: #2c3138;
  
  /* Colores adicionales */
  --blu: #1F85BA;      /* GRNB - Azul */
  --bludd: #1B6DA7;
  --blub-dark: #131923; /* BLUD - Azul más oscuro */
  --blul: #1b2937;     /* BLUL - Azul oscuro */
  --grnd: #37b670;     /* GRND - Verde */
  --grnl: #30ff64;     /* GRNL - Verde claro */
  --rr: #fa3144;       /* RR - Rojo */
  --yy: #ffa631;       /* YY - Amarillo */
  --rl: #ff5363;       /* RL - Rojo claro */
  --yl: #ffdd55;       /* YL - Amarillo claro */
  --wt: #ffffff;       /* WT - Blanco */
}

[data-theme="light"] {
  /* Colores base - Manteniendo nombres originales */
  --blub: #fff;   /* Azul claro */
  --blud: #e8f1fa;   /* Azul oscuro */
  --white: #1B1E23;
  --grayl: #2c3138;
  --gray: #2c3138;
  --gray-dark: #343a40;

  --whiteSET: #ffffff;
  --bludSET: #1B1E23;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, var(--blub) 0%, var(--blud) 100%);
  color: var(--white);

}

/* ===== ESTRUCTURA PRINCIPAL ===== */
.main-container {
  width: 100%;
  height: 100%;
  background: linear-gradient(180deg, var(--blud) 0%, var(--blub) 100%);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  position: relative;
  height: 100vh;
}

.dashboard-logo {
  max-width: 200px;
  height: auto;
  object-fit: contain;
}

.content-area {
  flex: 1;
  background: linear-gradient(180deg, var(--blud) 0%, var(--blub) 100%);
  border: 2px solid var(--blub);
  margin: 10px;
  padding: 15px;
  border-radius: 10px;
  position: relative;
  overflow: auto;
}

.grid-content {
  width: 1500px;
  height: 750px;
  background: transparent;
  border-radius: 0;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  display: flex;
  align-items: center;
  justify-content: center;
}

/* ===== HEADERS ===== */
.header {
  height: 35px;
  background: var(--blu);
  position: fixed;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 20px;
  position: relative;
  z-index: 10;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.top-header {
  height: 50px;
  background: var(--blu);
  display: flex;
  align-items: center;
  color: var(--whiteSET);
  justify-content: space-between;
  padding: 0 20px;
  z-index: 1000;

  
}

.window-controls {
  display: flex;
  gap: 10px;
}

/* ===== BOTONES GENERALES ===== */
.btn-header {
  background: transparent;
  border: 2px solid transparent;
  color: var(--whiteSET);
  font-weight: bold;
  padding: 8px 16px;
  border-radius: 15px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 5px;
  font-size: 15px;
}

.btn-header:hover {
  color: var(--bludSET);
}

.btn-header:disabled {
  color: var(--bludd);
  cursor: not-allowed;
}

.btn-header-logo {
  background: transparent;
  border: 2px solid transparent;
  color: transparent;
  font-weight: bold;
  padding: 8px 16px;
  border-radius: 15px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 5px;
  font-size: 15px;
}

.control-btn {
  background: transparent;
  border: none;
  color: var(--whiteSET);
  cursor: pointer;
  padding: 4px;
  border-radius: 4px;
  transition: background 0.3s ease;
}

.control-btn:hover {
  color: var(--bludSET)
}

.btn-icon {
  width: 20px;
  height: 20px;
  transition: filter 0.3s ease;
}

.control-icon {
  width: 25px;
  height: 25px;
}

/* ===== BOTONES POR COLOR/TIPO ===== */
/* Botón primario (verde) */
.btn-primary {
  background: var(--grnb);
  margin-top: 10px;
  color: var(--blub);
  border: none;
  border-radius: 5px;
  padding: 10px 20px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.3s ease;
}

.btn-primary:hover:not(:disabled) {
  background: var(--white);
  color: var(--grnb);
}

.btn-primary:disabled {
  opacity: 0.7;
  cursor: not-allowed;
}

.btn-primary:disabled:hover {
  background: var(--grnb);
  color: var(--blub);
}

/* Botón secundario (azul) */
.btn-secondary {
  background: var(--blu);
  color: var(--white);
  border: none;
  border-radius: 5px;
  padding: 10px 20px;
  margin-top: 10px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.3s ease;
}

.btn-secondary:hover:not(:disabled) {
  background: var(--white);
  color: var(--blu);
}

.btn-secondary:disabled {
  opacity: 0.7;
  cursor: not-allowed;
}

.btn-secondary:disabled:hover {
  background: var(--blu);
  color: var(--white);
}

/* Botón peligro/cancelar (rojo) */
.btn-danger {
  background: var(--rr);
  color: var(--white);
  border: none;
  border-radius: 5px;
  padding: 10px 20px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.3s ease;
}

.btn-danger:hover:not(:disabled) {
  background: var(--white);
  color: var(--rr);
}

.btn-danger:disabled {
  opacity: 0.7;
  cursor: not-allowed;
}

.btn-danger:disabled:hover {
  background: var(--rr);
  color: var(--white);
}

/* Botón advertencia (amarillo) */
.btn-warning {
  background: var(--yy);
  color: var(--blub);
  border: none;
  border-radius: 5px;
  padding: 10px 20px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.3s ease;
}

.btn-warning:hover:not(:disabled) {
  background: var(--white);
  color: var(--yy);
}

.btn-warning:disabled {
  opacity: 0.7;
  cursor: not-allowed;
}

.btn-warning:disabled:hover {
  background: var(--yy);
  color: var(--blub);
}

/* Botón con texto sin fondo */
.btn-text {
  background: none;
  border: none;
  color: var(--blu);
  cursor: pointer;
  font-size: 14px;
  text-decoration: underline;
  padding: 5px;
  transition: all 0.3s ease;
}

.btn-text:hover {
  color: var(--white);
  text-decoration: none;
}

/* Botón redondeado especial */
.btn-rounded {
  padding: 12px;
  border-radius: 15px;
  border: none;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
}

/* ===== INPUTS GENERALES ===== */
.input-field {
  width: 100%;
  padding: 10px 16px;
  border-radius: 5px;
  border: 2px solid var(--blu);
  background: var(--blud);
  color: var(--white);
  font-size: 16px;
  outline: none;
  transition: border-color 0.3s ease, background-color 0.3s ease;
}

.input-field:focus {
  border-color: var(--grnb);
  background: var(--blud);
  color: var(--white);
}

.input-field:hover {
  border-color: var(--blu);
}

.input-field::placeholder {
  color: rgba(255, 255, 255, 0.5);
}

/* Input especial para códigos */
.code-input {
  width: 45px;
  height: 45px;
  font-size: 24px;
  background: var(--blud);
  color: var(--white);
  text-align: center;
  border: 2px solid var(--blub);
  border-radius: 5px;
  outline: none;
  transition: border-color 0.3s ease;
}

.code-input:focus {
  border-color: var(--blu);
}

.code-input-filled {
  border-color: var(--blu);
}

/* Input de búsqueda */
.search-input {
  width: 100%;
  padding: 10px;
  border-radius: 5px;
  border: 1px solid var(--blu);
  background: var(--blud);
  color: var(--white);
}

.search-input:focus {
  border-color: var(--blu);
  outline: none;
}

/* Textarea */
.textarea-field {
  width: 100%;
  padding: 10px;
  border: 1px solid var(--blu);
  background: var(--blud);
  color: var(--white);
  border-radius: 5px;
  resize: vertical;
  min-height: 100px;
}

.textarea-field:focus {
  border-color: var(--blu);
  outline: none;
}

/* Select */
.select-field {
  width: 100%;
  padding: 10px;
  border: 1px solid var(--blu);
  background: var(--blud);
  color: var(--white);
  border-radius: 5px;
}

.select-field:focus {
  border-color: var(--blu);
  outline: none;
}

/* ===== TARJETAS Y CONTENEDORES ===== */
.card {
  background: linear-gradient(180deg, var(--blud) 0%, var(--blub) 100%);
  border: 2px solid var(--blub);
  backdrop-filter: blur(10px);
  border-radius: 10px;
  padding: 20px;
  color: var(--white);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

.card-primary {
  border-color: var(--grnb);
}

.card-secondary {
  border-color: var(--blu);
}

.card-danger {
  border-color: var(--rr);
}

.card-warning {
  border-color: var(--yy);
}

/* Contenedor con fondo semitransparente */
.container-transparent {
  background: rgba(0, 0, 0, 0.30);
  border-radius: 10px;
  padding: 20px;
  backdrop-filter: blur(10px);
}

/* ===== MODALES ===== */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  animation: fadeIn 0.3s ease;
}

.modal-container {
  background: linear-gradient(180deg, var(--blud) 0%, var(--blub) 100%);
  border: 2px solid var(--blub);
  border-radius: 10px;
  padding: 30px;
  color: var(--white);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
  backdrop-filter: blur(10px);
  max-width: 500px;
  width: 90%;
  max-height: 90vh;
  overflow-y: auto;
  animation: slideUp 0.3s ease;
}

.modal-large {
  max-width: 800px;
  width: 95%;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 15px;
  border-bottom: 2px solid var(--blu);
}

.modal-title {
  margin: 0;
  color: var(--blu);
  font-size: 1.5em;
}

.modal-close {
  background: transparent;
  border: none;
  color: var(--rr);
  font-size: 28px;
  cursor: pointer;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: all 0.3s ease;
}

.modal-close:hover {
  color: var(--white);
  background: rgba(255, 255, 255, 0.1);
}

.modal-content {
  margin-bottom: 20px;
}

.modal-footer {
  display: flex;
  gap: 10px;
  justify-content: flex-end;
  margin-top: 20px;
  padding-top: 15px;
  border-top: 2px solid var(--blu);
}

/* ===== GRIDS Y LAYOUTS ===== */
.grid-2 {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 20px;
}

.grid-3 {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 15px;
}

.grid-auto {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
}

.flex-row {
  display: flex;
  gap: 15px;
  align-items: center;
}

.flex-col {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

/* ===== ESTADOS Y MENSAJES ===== */
.error-message {
  color: var(--white);
  background: rgba(231, 76, 60, 0.2);
  padding: 10px;
  border-radius: 5px;
  margin-bottom: 15px;
  border: 1px solid var(--rr);
}

.success-message {
  color: var(--white);
  background: rgba(52, 152, 219, 0.2);
  padding: 10px;
  border-radius: 5px;
  margin-bottom: 15px;
  border: 1px solid var(--blu);
  font-weight: bold;
  text-align: center;
}

.warning-message {
  color: var(--white);
  background: rgba(241, 196, 15, 0.2);
  padding: 10px;
  border-radius: 5px;
  margin-bottom: 15px;
  border: 1px solid var(--yy);
}

/* Estados de carga */
.loading-container {
  text-align: center;
  padding: 40px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.loading-spinner {
  width: 50px;
  height: 50px;
  border: 5px solid var(--blu);
  border-top: 5px solid var(--white);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

.loading-text {
  font-size: 18px;
  margin-top: 15px;
  color: var(--blu);
}

/* Estados de usuario/privilegios */
.status-verified {
  color: var(--grnb);
  font-weight: bold;
}

.status-pending {
  color: var(--yy);
  font-weight: bold;
}

.status-active {
  color: var(--grnb);
  font-weight: bold;
}

.status-inactive {
  color: var(--rr);
  font-weight: bold;
}

.privilege-admin {
  color: var(--rr);
  font-weight: bold;
}

.privilege-vendor {
  color: var(--blu);
  font-weight: bold;
}

/* ===== SCROLLBAR ===== */
.scrollable {
  overflow-y: auto;
}

.scrollable::-webkit-scrollbar {
  width: 6px;
}

.scrollable::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 3px;
}

.scrollable::-webkit-scrollbar-thumb {
  background: var(--white);
  border-radius: 3px;
}

.scrollable::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* Para Firefox */
.scrollable {
  scrollbar-width: thin;
  scrollbar-color: var(--white) rgba(255, 255, 255, 0.05);
}

/* ===== ANIMACIONES ===== */
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideUp {
  from { transform: translateY(30px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* ===== RESPONSIVE ===== */
@media (max-width: 768px) {
  .grid-2,
  .grid-3 {
    grid-template-columns: 1fr;
  }
  
  .modal-container {
    width: 95%;
    padding: 20px;
  }
  
  .modal-footer {
    flex-direction: column;
  }
  
  .flex-row {
    flex-direction: column;
  }
  
  .btn-header {
    padding: 6px 12px;
    font-size: 14px;
  }
}

@media (max-width: 480px) {
  .header,
  .top-header {
    padding: 0 10px;
  }
  
  .modal-container {
    padding: 15px;
  }
  
  .btn-primary,
  .btn-secondary,
  .btn-danger,
  .btn-warning {
    padding: 8px 15px;
    font-size: 14px;
  }
}

/* ===== UTILIDADES ===== */
.text-center {
  text-align: center;
}

.text-right {
  text-align: right;
}

.text-left {
  text-align: left;
}

.mt-10 { margin-top: 10px; }
.mt-20 { margin-top: 20px; }
.mb-10 { margin-bottom: 10px; }
.mb-20 { margin-bottom: 20px; }
.ml-10 { margin-left: 10px; }
.mr-10 { margin-right: 10px; }

.p-10 { padding: 10px; }
.p-20 { padding: 20px; }
.pt-10 { padding-top: 10px; }
.pb-10 { padding-bottom: 10px; }

.w-100 { width: 100%; }
.h-100 { height: 100%; }

.hidden { display: none; }
.flex { display: flex; }
.grid { display: grid; }
.block { display: block; }
.inline { display: inline; }
.inline-block { display: inline-block; }

/* Tablas */
.table-container {
  width: 100%;
  overflow-x: auto;
  background: var(--blud);
  border-radius: 8px;
  border: 1px solid var(--blub);
}

.data-table {
  width: 100%;
  border-collapse: collapse;
  color: var(--white);
}

.data-table th {
  background: var(--bludSET);
  padding: 12px 15px;
  text-align: left;
  font-weight: bold;
  border-bottom: 2px solid var(--blu);
}

.data-table td {
  padding: 12px 15px;
  border-bottom: 1px solid var(--blub);
}

.data-table tr:hover {
  background: rgba(31, 133, 186, 0.1);
}

.data-table tr:last-child td {
  border-bottom: none;
}

/* Badges */
.badge {
  display: inline-block;
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: bold;
  text-transform: uppercase;
}

.badge-success {
  background: rgba(31, 186, 121, 0.2);
  color: var(--grnb);
  border: 1px solid var(--grnb);
}

.badge-warning {
  background: rgba(255, 166, 49, 0.2);
  color: var(--yy);
  border: 1px solid var(--yy);
}

.badge-danger {
  background: rgba(250, 49, 68, 0.2);
  color: var(--rr);
  border: 1px solid var(--rr);
}

.badge-info {
  background: rgba(64, 148, 232, 0.2);
  color: var(--blu);
  border: 1px solid var(--blu);
}

/* Progress bars */
.progress-container {
  width: 100%;
  height: 8px;
  background: var(--blub);
  border-radius: 4px;
  overflow: hidden;
}

.progress-bar {
  height: 100%;
  background: linear-gradient(90deg, var(--blu) 0%, var(--bludd) 100%);
  border-radius: 4px;
  transition: width 0.3s ease;
}

/* Avatars */
.avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: var(--blu);
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--white);
  font-weight: bold;
  font-size: 16px;
}

.avatar-small {
  width: 32px;
  height: 32px;
  font-size: 14px;
}

.avatar-large {
  width: 60px;
  height: 60px;
  font-size: 24px;
}

/* Tabs */
.tabs {
  display: flex;
  border-bottom: 2px solid var(--blub);
  margin-bottom: 20px;
}

.tab {
  padding: 12px 24px;
  background: transparent;
  border: none;
  color: var(--grayl);
  cursor: pointer;
  font-weight: bold;
  transition: all 0.3s ease;
  border-bottom: 2px solid transparent;
  margin-bottom: -2px;
}

.tab:hover {
  color: var(--white);
}

.tab.active {
  color: var(--blu);
  border-bottom: 2px solid var(--blu);
}

/* Accordion */
.accordion {
  border: 1px solid var(--blub);
  border-radius: 8px;
  margin-bottom: 10px;
  overflow: hidden;
}

.accordion-header {
  padding: 15px 20px;
  background: var(--blud);
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-weight: bold;
  transition: background 0.3s ease;
}

.accordion-header:hover {
  background: var(--blub);
}

.accordion-content {
  padding: 20px;
  background: rgba(0, 0, 0, 0.1);
  border-top: 1px solid var(--blub);
}

/* Pagination */
.pagination {
  display: flex;
  gap: 5px;
  justify-content: center;
  margin-top: 20px;
}

.page-item {
  background: var(--blud);
  border: 1px solid var(--blub);
  color: var(--white);
  padding: 8px 12px;
  cursor: pointer;
  border-radius: 4px;
  transition: all 0.3s ease;
}

.page-item:hover {
  background: var(--white);
  border-color: var(--white);
}

.page-item.active {
  background: var(--blu);
  border-color: var(--blu);
  color: var(--blud);
}

/* Timeline para actividad reciente */
.timeline {
  position: relative;
  padding-left: 30px;
}

.timeline::before {
  content: '';
  position: absolute;
  left: 15px;
  top: 0;
  bottom: 0;
  width: 2px;
  background: var(--bludd);
}

.timeline-item {
  position: relative;
  margin-bottom: 20px;
}

.timeline-item::before {
  content: '';
  position: absolute;
  left: -20px;
  top: 40px;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: var(--white);

}

.timeline-content {
  background: linear-gradient(180deg, var(--blud) 0%, var(--blub) 100%);
  padding: 15px;
  border-radius: 8px;
  border: 1px solid var(--blub);
}

/* Layout Styles */
.content-wrapper {
  display: flex;
  flex: 1;
  overflow: auto;
  min-height: 0;
  height: calc(100vh - 80px);
}

.sidebar {
  width: 250px;
  background: var(--blub);
  border-right: 1px solid var(--blub);
  transition: width 0.3s ease;
  overflow-y: auto;
}

.sidebar.closed {
  width: 70px;
}

.main-content {
  flex: 1;
  overflow-y: auto;
}

.sidebar-nav {
  padding: 20px 0;
}

.sidebar-nav-item {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 12px 20px;
  color: var(--grayl);
  text-decoration: none;
  transition: all 0.3s ease;
  border-left: 3px solid transparent;
}

.sidebar-nav-item:hover {
  background: rgba(31, 133, 186, 0.1);
  color: var(--blu);
  border-left-color: var(--blu);
}

.sidebar-nav-item.active {
  background: rgba(31, 133, 186, 0.2);
  color: var(--white);
  border-left-color: var(--blu);
}

.sidebar-nav-item svg {
  font-size: 20px;
  color: var(--blu);
  min-width: 24px;
}

.status-bar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 30px;
  background: var(--blud);
  border-top: 1px solid var(--blub);
  padding: 0 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  font-size: 12px;
  color: var(--grayl);
  z-index: 1000;
}

.user-info {
  display: flex;
  
  align-items: center;
  gap: 10px;
}

.user-email {
  color: var(--whiteSET);
  font-weight: 500;
}

/* Dashboard Styles */
.dashboard-page {
  padding: 0px;
}

.page-header {
  margin-bottom: 30px;
}

.page-header h1 {
  color: var(--whiteset);
  margin-bottom: 5px;
}

.page-header p {
  color: var(--grayl);
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.stat-card {
  background: linear-gradient(180deg, var(--blud) 0%, var(--blub) 100%);
  border: 1px solid var(--blub);
  border-radius: 10px;
  padding: 20px;
  transition: all 0.3s ease;
}

.stat-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
  border-color: var(--blu);
}

.stat-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 15px;
}

.stat-header h3 {
  font-size: 14px;
  color: var(--white);
  font-weight: normal;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.stat-value {
  font-size: 32px;
  font-weight: bold;
  color: var(--white);
  margin-bottom: 10px;
}

.stat-change {
  font-size: 12px;
  color: var(--grayl);
}

.dashboard-content-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
}

.dashboard-section {
  background: var(--blud);
  border: 1px solid var(--blub);
  border-radius: 10px;
  padding: 20px;
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.citas-list, .pacientes-list {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.cita-item, .paciente-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 8px;
  transition: background 0.3s ease;
}

.cita-item:hover, .paciente-item:hover {
  background: rgba(255, 255, 255, 0.1);
}

.cita-info, .paciente-info {
  flex: 1;
}

.cita-paciente, .paciente-nombre {
  font-weight: bold;
  color: var(--white);
}

.cita-hora, .paciente-fecha {
  font-size: 12px;
  color: var(--grayl);
}

.paciente-progreso {
  display: flex;
  align-items: center;
  gap: 10px;
  width: 150px;
}

.progreso-text {
  font-size: 12px;
  color: var(--blu);
  min-width: 40px;
}

.activity-chart {
  height: 200px;
  padding: 20px;
}

.chart-bars {
  display: flex;
  align-items: flex-end;
  gap: 10px;
  height: 100%;
  padding-top: 20px;
}

.chart-bar {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  height: 100%;
}

.bar-fill {
  width: 20px;
  background: linear-gradient(to top, var(--blu), var(--bludd));
  border-radius: 4px 4px 0 0;
  transition: height 0.3s ease;
}

.bar-label {
  margin-top: 10px;
  font-size: 12px;
  color: var(--grayl);
}

.quick-actions {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

/* Calendar Styles */
.calendar-controls {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding: 15px;
  background: var(--blud);
  border-radius: 10px;
  border: 1px solid var(--blub);
}

.view-selector {
  display: flex;
  gap: 5px;
}

.date-navigation {
  display: flex;
  align-items: center;
  gap: 20px;
}

.current-date h3 {
  color: var(--white);
  margin: 0;
}

.calendar-day-view {
  display: flex;
  height: 600px;
  overflow-y: auto;
  background: var(--blud);
  border-radius: 10px;
  border: 1px solid var(--blub);
  margin-bottom: 20px;
}

.time-column {
  width: 80px;
  border-right: 1px solid var(--blub);
}

.time-slot {
  height: 60px;
  display: flex;
  align-items: flex-start;
  justify-content: flex-end;
  padding: 5px 10px;
  border-bottom: 1px solid var(--blub);
}

.time-label {
  color: var(--grayl);
  font-size: 12px;
}

.events-column {
  flex: 1;
  position: relative;
}

.hour-slot {
  height: 60px;
  border-bottom: 1px solid var(--blub);
  position: relative;
}

.event-item {
  position: absolute;
  left: 10px;
  right: 10px;
  background: var(--blub);
  border-radius: 8px;
  padding: 10px;
  overflow: hidden;
  transition: all 0.3s ease;
}

.event-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

.event-confirmed {
  border-left: 4px solid var(--grnb);
}

.event-pending {
  border-left: 4px solid var(--yy);
}

.event-cancelled {
  border-left: 4px solid var(--rr);
}

.event-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 5px;
}

.event-time {
  font-size: 12px;
  color: var(--grayl);
  display: flex;
  align-items: center;
  gap: 5px;
}

.event-content {
  margin-bottom: 10px;
}

.event-patient {
  font-weight: bold;
  color: var(--white);
  display: flex;
  align-items: center;
  gap: 5px;
}

.event-type {
  font-size: 12px;
  color: var(--blu);
  margin-top: 2px;
}

.event-notes {
  font-size: 11px;
  color: var(--white);
  margin-top: 2px;
}

.event-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.day-citas-list {
  background: var(--blud);
  border-radius: 10px;
  border: 1px solid var(--blub);
  padding: 20px;
}

.citas-cards {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 15px;
  margin-top: 15px;
}

.cita-card {
  background: linear-gradient(180deg, var(--blud) 0%, var(--blub) 100%);
  border: 1px solid var(--blub);
  border-radius: 10px;
  padding: 15px;
  transition: all 0.3s ease;
}

.cita-card:hover {

  transform: translateY(-2px);
}

.cita-card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.cita-card-body {
  margin-bottom: 15px;
}

.cita-card-footer {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}

.no-citas {
  text-align: center;
  padding: 40px;
  color: var(--grayl);
}

.no-citas-icon {
  font-size: 48px;
  margin-bottom: 15px;
}

/* Configuration Styles */
.configuracion-container {
  display: flex;
  gap: 30px;
  margin-bottom: 30px;
}

.config-tabs {
  width: 250px;
  display: flex;
  flex-direction: column;
  gap: 5px;
}

.config-tab {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 15px 20px;
  background: transparent;
  border: none;
  color: var(--grayl);
  text-align: left;
  cursor: pointer;
  border-radius: 8px;
  transition: all 0.3s ease;
}

.config-tab:hover {
  background: rgba(255, 255, 255, 0.05);
  color: var(--white);
}

.config-tab.active {
  background: rgba(31, 133, 186, 0.2);
  color: var(--blu);
  border: 3px solid var(--blu);
}

.config-tab svg {
  font-size: 20px;
}

.config-content {
  flex: 1;
  background: var(--blud);
  border: 1px solid var(--blub);
  border-radius: 10px;
  padding: 30px;
}

.tab-content h3 {
  color: var(--grnb);
  margin-bottom: 25px;
}

.form-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 20px;
  margin-bottom: 30px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  color: var(--white);
  font-weight: 500;
}

.form-actions {
  display: flex;
  justify-content: flex-end;
  gap: 15px;
  margin-top: 30px;
  padding-top: 20px;
  border-top: 1px solid var(--blub);
}

.security-info {
  margin-top: 30px;
  padding: 20px;
  background: rgba(0, 0, 0, 0.2);
  border-radius: 8px;
  border-left: 4px solid var(--blu);
}

.security-info h4 {
  color: var(--blu);
  margin-bottom: 10px;
}

.security-info ul {
  padding-left: 20px;
  color: var(--grayl);
}

.security-info li {
  margin-bottom: 5px;
}

.notifications-list {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.notification-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 8px;
  border: 1px solid var(--blub);
}

.notification-item h4 {
  color: var(--white);
  margin-bottom: 5px;
}

.notification-item p {
  color: var(--grayl);
  font-size: 14px;
}

.switch {
  position: relative;
  display: inline-block;
  width: 50px;
  height: 24px;
}

.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: var(--blub);
  transition: .4s;
  border-radius: 34px;
}

.slider:before {
  position: absolute;
  content: "";
  height: 16px;
  width: 16px;
  left: 4px;
  bottom: 4px;
  background-color: var(--white);
  transition: .4s;
  border-radius: 50%;
}

input:checked + .slider {
  background-color: var(--blu);
}

input:checked + .slider:before {
  transform: translateX(26px);
}

.horario-disponibilidad {
  margin: 30px 0;
  padding: 20px;
  background: rgba(0, 0, 0, 0.2);
  border-radius: 8px;
}

.dias-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  gap: 15px;
  margin-top: 15px;
}

.dia-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 8px;
}

.advanced-settings {
  background: var(--blud);
  border: 1px solid var(--blub);
  border-radius: 10px;
  padding: 30px;
  margin-top: 30px;
}

.advanced-actions {
  display: flex;
  gap: 15px;
  margin-top: 20px;
}

.alert-message {
  padding: 15px 20px;
  border-radius: 8px;
  margin-bottom: 20px;
  border-left: 4px solid;
}

.alert-message.success {
  background: rgba(31, 186, 101, 0.2);
  border-color: var(--grnb);
  color: var(--grnb);
}

.alert-message.error {
  background: rgba(250, 49, 68, 0.2);
  border-color: var(--rr);
  color: var(--rr);
}

/* Responsive */
@media (max-width: 1024px) {
  .form-grid {
    grid-template-columns: 1fr;
  }
  
  .configuracion-container {
    flex-direction: column;
  }
  
  .config-tabs {
    width: 100%;
    flex-direction: row;
    overflow-x: auto;
  }
}

@media (max-width: 768px) {
  .stats-grid,
  .dashboard-content-grid {
    grid-template-columns: 1fr;
  }
  
  .calendar-controls {
    flex-direction: column;
    gap: 15px;
    align-items: flex-start;
  }
  
  .date-navigation {
    width: 100%;
    justify-content: space-between;
  }
  
  .citas-cards {
    grid-template-columns: 1fr;
  }
}

/* Clases de utilidad adicionales */
.gap-5 { gap: 5px; }
.gap-10 { gap: 10px; }
.gap-20 { gap: 20px; }
.align-center { align-items: center; }
.font-bold { font-weight: bold; }
.text-small { font-size: 12px; }
.text-danger { color: var(--rr); }
.text-success { color: var(--grnb); }

/* Estilos para el modal de nueva cita */
.modal-overlay-nueva-cita {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  animation: fadeIn 0.3s ease;
}

.modal-container-nueva-cita {
  background: var(--blub);
  border-radius: 10px;
  padding: 25px;
  width: 500px;
  max-width: 90%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
  animation: slideUp 0.3s ease;
  border: 2px solid var(--blu);
}

.modal-title-nueva-cita {
  color: var(--blu);
  margin-bottom: 20px;
  font-size: 24px;
  border-bottom: 2px solid var(--blu);
  padding-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.form-input-nueva-cita {
  width: 100%;
  padding: 12px;
  margin-bottom: 15px;
  border: 1px solid var(--grayl);
  border-radius: 5px;
  background: var(--blud);
  color: var(--white);
  font-size: 16px;
  transition: all 0.3s ease;
}

.form-input-nueva-cita:focus {
  outline: none;
  border-color: var(--blu);

}

.form-select-nueva-cita {
  width: 100%;
  padding: 12px;
  margin-bottom: 15px;
  border: 1px solid var(--grayl);
  border-radius: 5px;
  background: var(--blud);
  color: var(--white);
  font-size: 16px;
  cursor: pointer;
}

.form-select-nueva-cita:focus {
  outline: none;
  border-color: var(--blu);
}

.form-textarea-nueva-cita {
  width: 100%;
  padding: 12px;
  margin-bottom: 15px;
  border: 1px solid var(--grayl);
  border-radius: 5px;
  background: var(--blud);
  color: var(--white);
  font-size: 16px;
  min-height: 100px;
  resize: vertical;
}

.modal-buttons-container-nueva-cita {
  display: flex;
  gap: 10px;
  justify-content: flex-end;
  margin-top: 20px;
}

.modal-button-nueva-cita {
  padding: 12px 24px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 16px;
  font-weight: bold;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 8px;
}

.button-success-nueva-cita {
  background: var(--grnb);
  color: var(--white);
}

.button-success-nueva-cita:hover {
  transform: translateY(-2px);
}

.button-danger-nueva-cita {
  background: var(--rr);
  color: var(--white);
}

.button-danger-nueva-cita:hover {
  background: var(--rl);
  transform: translateY(-2px);
}

.error-message-nueva-cita {
  background: var(--rl);
  color: var(--white);
  padding: 12px;
  border-radius: 5px;
  margin-bottom: 15px;
  animation: shake 0.5s ease;
}

.info-box-nueva-cita {
  background: var(--blul);
  padding: 15px;
  border-radius: 5px;
  margin-bottom: 15px;
  color: var(--blu);
  border-left: 4px solid var(--blu);
}

/* Animaciones */
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideUp {
  from { 
    opacity: 0;
    transform: translateY(20px);
  }
  to { 
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  75% { transform: translateX(5px); }
}

/* Media queries para responsive */
@media (max-width: 768px) {
  .modal-container-nueva-cita {
    width: 95%;
    padding: 15px;
  }
  
  .modal-buttons-container-nueva-cita {
    flex-direction: column;
  }
  
  .modal-button-nueva-cita {
    width: 100%;
    justify-content: center;
  }
}


/* ===== ESTILOS PARA NUEVAS PÁGINAS ===== */

/* Notificaciones */
.unread {
  background: rgba(64, 148, 232, 0.1);
  border-left-color: var(--blu) !important;
}

.notification-icon {
  font-size: 24px;
  min-width: 40px;
}

.notification-content {
  flex: 1;
}

.notification-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 5px;
}

.notification-time {
  font-size: 12px;
  color: var(--grayl);
  display: flex;
  align-items: center;
  gap: 5px;
}

.notification-type {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 15px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 8px;
}

.notification-type-icon {
  font-size: 28px;
}

.notification-type-info {
  flex: 1;
}

.notification-type-info strong {
  display: block;
  margin-bottom: 5px;
}

.notification-type-info p {
  font-size: 13px;
  color: var(--grayl);
  margin: 0;
}

/* Observaciones y Sesiones */
.observaciones-list,
.sesiones-list {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

/* Expedientes */
.diagnostico-tag {
  background: rgba(31, 133, 186, 0.1);
  color: var(--blu);
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
  border: 1px solid rgba(31, 133, 186, 0.3);
}

/* Supervisión */
.flex-1 {
  flex: 1;
}

/* Layouts específicos por rol */
.user-rol {
  font-size: 12px;
  background: rgba(255, 255, 255, 0.1);
  padding: 2px 8px;
  border-radius: 10px;
  margin-left: 5px;
}

.user-especialidad {
  font-size: 12px;
  color: var(--whiteSET);
  margin-left: 5px;
}

.sidebar-info {
  padding: 20px;
  border-top: 1px solid var(--blub);
  margin-top: auto;
}

.sidebar-info-item {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 12px;
  color: var(--grayl);
  margin-bottom: 10px;
}

.badge-notificacion {
  position: absolute;
  top: -5px;
  right: -5px;
  background: var(--rr);
  color: var(--white);
  font-size: 10px;
  padding: 2px 6px;
  border-radius: 10px;
  min-width: 18px;
  text-align: center;
}

/* Grids responsivos */
.grid-4 {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
}

/* Detalles en modales */
.detail-row {
  display: flex;
  justify-content: space-between;
  padding: 8px 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.detail-row strong {
  color: var(--blu);
}

.detail-row.notes {
  flex-direction: column;
  align-items: flex-start;
}

.detail-row.notes p {
  margin-top: 5px;
  color: var(--grayl);
}

/* Ajustes responsive */
@media (max-width: 1200px) {
  .grid-4 {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 768px) {
  .grid-4 {
    grid-template-columns: 1fr;
  }
  
  .notification-item {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .notification-icon {
    margin-bottom: 10px;
  }
}

/* Animaciones adicionales */
@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

.pulse {
  animation: pulse 2s infinite;
}

/* Estados de usuario */
.estado-activo {
  color: var(--grnb);
}

.estado-inactivo {
  color: var(--rr);
}

/* Barra de progreso en cards */
.card-progress {
  margin-top: 15px;
}

.card-progress-label {
  display: flex;
  justify-content: space-between;
  margin-bottom: 5px;
  font-size: 12px;
  color: var(--grayl);
}

/* Filtros mejorados */
.filters-container {
  display: flex;
  gap: 20px;
  align-items: center;
}

.search-box {
  flex: 1;
  position: relative;
  display: flex;
  align-items: center;
}

.search-box svg {
  position: absolute;
  left: 15px;
  color: var(--grayl);
}

.search-input {
  padding-left: 45px;
}

.filter-buttons {
  display: flex;
  gap: 10px;
}

/* Ajustes para tablas */
.data-table th,
.data-table td {
  vertical-align: middle;
}

/* Mejoras en accordions */
.accordion-header {
  align-items: center;
}

.accordion-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease;
}

.accordion.active .accordion-content {
  max-height: 1000px;
}

/* Timeline mejorado */
.timeline-item:last-child {
  margin-bottom: 0;
}

.timeline-content strong {
  color: var(--blu);
  display: block;
  margin-bottom: 5px;
}

/* Utilidades adicionales */
.ml-10 { margin-left: 10px; }
.mr-10 { margin-right: 10px; }
.mt-30 { margin-top: 30px; }

.justify-between { justify-content: space-between; }
.justify-end { justify-content: flex-end; }
.flex-wrap { flex-wrap: wrap; }

.text-primary { color: var(--blu); }
.text-warning { color: var(--yy); }
.text-info { color: var(--grnb); }

/* Botones en tablas */
.btn-table {
  padding: 4px 8px;
  font-size: 12px;
  min-width: auto;
}

/* Estado de carga global */
.global-loader {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: var(--blud);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

.global-loader-content {
  text-align: center;
}

.global-loader-spinner {
  width: 60px;
  height: 60px;
  border: 5px solid rgba(255, 255, 255, 0.1);
  border-top: 5px solid var(--blu);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 20px;
}

.global-loader-text {
  font-size: 18px;
  color: var(--blu);
  font-weight: bold;
}



/* Estilos para el toggle switch */
.toggle-container {
  display: flex;
  align-items: center;
}

.toggle-checkbox {
  display: none;
}

.toggle-label {
  position: relative;
  display: flex;
  align-items: center;
  width: 60px;
  height: 30px;
  background: var(--white);
  border-radius: 50px;
  cursor: pointer;
  transition: all 0.3s ease;
  overflow: hidden;

}

[data-theme="light"] .toggle-label {
  background: var(--white);

}

.toggle-ball {
  position: absolute;
  left: 3px;
  width: 24px;
  height: 24px;
  background: var(--blud);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  z-index: 2;

  color: var(--yy);
}

.toggle-checkbox:checked + .toggle-label .toggle-ball {
  left: calc(100% - 27px);
  color: var(--blu);
}

.toggle-icons {
  display: flex;
  justify-content: space-between;
  width: 100%;
  padding: 0 8px;
  z-index: 1;
}

.sun-icon {
  color: var(--yy);
  opacity: 0.7;
  transition: opacity 0.3s ease;
}

.moon-icon {
  color: var(--blu);
  opacity: 0.7;
  transition: opacity 0.3s ease;
}

.toggle-checkbox:not(:checked) + .toggle-label .sun-icon {
  opacity: 1;
}

.toggle-checkbox:checked + .toggle-label .moon-icon {
  opacity: 1;
}




/* Efecto activo */
.toggle-label:active {
  transform: scale(0.95);
}

/* Animación suave para el cambio de tema */
.main-container,
.sidebar,
.main-content,
.card,
.input-field,
.data-table,
.btn-primary,
.btn-secondary {
  transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
}




/backend/src/routes/altaRoutes.js:
--------------------------------------------------------------------------------
const express = require('express');
const router = express.Router();
const AltaController = require('../controllers/altaController');
const verifyToken = require('../middlewares/authMiddleware');
const { requireRole } = require('../middlewares/roleMiddleware');

// Todas las rutas requieren autenticación
router.use(verifyToken);

// Dar de alta paciente
router.post('/', requireRole(['psicologo', 'coordinador']), AltaController.darAltaPaciente);

// Obtener altas
router.get('/', requireRole(['coordinador', 'psicologo']), AltaController.obtenerAltas);
router.get('/estadisticas', requireRole(['coordinador']), AltaController.obtenerEstadisticasAltas);
router.get('/:id', requireRole(['coordinador', 'psicologo']), AltaController.obtenerAltaDetalle);

module.exports = router;


/backend/src/models/pacienteModel.js:
--------------------------------------------------------------------------------
const { DataTypes } = require('sequelize');
const sequelize = require('../config/db');

const Paciente = sequelize.define('Paciente', {
    id: {
        type: DataTypes.INTEGER,
        primaryKey: true,
        autoIncrement: true
    },
    nombre: {
        type: DataTypes.STRING(100),
        allowNull: false
    },
    apellido: {
        type: DataTypes.STRING(100),
        allowNull: false
    },
    email: {
        type: DataTypes.STRING(255),
        allowNull: true,
        validate: {
            isEmail: true
        }
    },
    telefono: {
        type: DataTypes.STRING(20),
        allowNull: true
    },
    fecha_nacimiento: {
        type: DataTypes.DATEONLY,
        allowNull: true
    },
    genero: {
        type: DataTypes.ENUM('masculino', 'femenino', 'otro', 'prefiero_no_decir'),
        allowNull: true
    },
    direccion: {
        type: DataTypes.TEXT,
        allowNull: true
    },
    estado: {
        type: DataTypes.STRING(50),
        allowNull: false,
        defaultValue: 'activo'
    },
    activo: {
        type: DataTypes.BOOLEAN,
        allowNull: false,
        defaultValue: true
    },
    notas: {
        type: DataTypes.TEXT,
        allowNull: true
    },
    fundacion_id: {
        type: DataTypes.INTEGER,
        allowNull: true
    }
}, {
    tableName: 'pacientes',
    timestamps: true,
    createdAt: 'created_at',
    updatedAt: 'updated_at',
    underscored: true,
    indexes: [
        {
            fields: ['activo']
        },
        {
            fields: ['apellido', 'nombre']
        }
    ]
});

module.exports = Paciente;


/frontend/src/index.js:
--------------------------------------------------------------------------------
import React from 'react';
import ReactDOM from 'react-dom/client';
import './global.css';
import './App.css';

// Importa los estilos de los modales
import './components/Common/ConfirmModal.css';
import './components/Common/NotificationModal.css';

import App from './App';

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);


/backend/src/models/altaModel.js:
--------------------------------------------------------------------------------
const { DataTypes } = require('sequelize');
const sequelize = require('../config/db');
const Paciente = require('./pacienteModel');
const User = require('./userModel');

const Alta = sequelize.define('Alta', {
    id: {
        type: DataTypes.INTEGER,
        primaryKey: true,
        autoIncrement: true
    },
    paciente_id: {
        type: DataTypes.INTEGER,
        allowNull: false,
        references: {
            model: Paciente,
            key: 'id'
        }
    },
    usuario_id: {
        type: DataTypes.INTEGER,
        allowNull: false,
        references: {
            model: User,
            key: 'id'
        }
    },
    tipo_alta: {
        type: DataTypes.ENUM(
            'terapeutica',
            'abandono',
            'traslado',
            'graduacion',
            'no_continua',
            'otro'
        ),
        allowNull: false
    },
    fecha_alta: {
        type: DataTypes.DATEONLY,
        allowNull: false,
        defaultValue: DataTypes.NOW
    },
    motivo_detallado: {
        type: DataTypes.TEXT,
        allowNull: true
    },
    recomendaciones: {
        type: DataTypes.TEXT,
        allowNull: true
    },
    sesiones_totales: {
        type: DataTypes.INTEGER,
        allowNull: true
    },
    evaluacion_final: {
        type: DataTypes.ENUM('excelente', 'buena', 'regular', 'mala'),
        allowNull: true
    },
    seguimiento_recomendado: {
        type: DataTypes.BOOLEAN,
        defaultValue: false
    },
    fecha_seguimiento: {
        type: DataTypes.DATEONLY,
        allowNull: true
    }
}, {
    tableName: 'altas',
    timestamps: true,
    createdAt: 'created_at',
    updatedAt: 'updated_at',
    underscored: true,
    indexes: [
        {
            fields: ['paciente_id']
        },
        {
            fields: ['fecha_alta']
        },
        {
            fields: ['tipo_alta']
        }
    ]
});

Alta.belongsTo(Paciente, { foreignKey: 'paciente_id' });
Alta.belongsTo(User, { foreignKey: 'usuario_id' });

module.exports = Alta;


/backend/server.js:
--------------------------------------------------------------------------------
const path = require('path');
require('dotenv').config({ path: path.resolve(__dirname, '../.env') });

const express = require('express');
const swaggerUi = require('swagger-ui-express');
const swaggerDocument = require('./src/doc/swagger.json');
const cors = require('cors');

const sequelize = require('./src/config/db');

// Importar modelos
require('./src/models/userModel');
require('./src/models/pacienteModel');
require('./src/models/citaModel');
// Importar otros modelos según necesites

const authRoutes = require('./src/routes/authRoutes');
const citaRoutes = require('./src/routes/citaRoutes');
const roleRoutes = require('./src/routes/roleRoutes');
const fundacionRoutes = require('./src/routes/fundacionRoutes');
const asignacionRoutes = require('./src/routes/asignacionRoutes');
const sesionRoutes = require('./src/routes/sesionRoutes');
const notificacionRoutes = require('./src/routes/notificacionRoutes');
const altaRoutes = require('./src/routes/altaRoutes');
const reporteRoutes = require('./src/routes/reporteRoutes');
const observacionRoutes = require('./src/routes/observacionRoutes');
const disponibilidadRoutes = require('./src/routes/disponibilidadRoutes');
const expedienteRoutes = require('./src/routes/expedienteRoutes');
const dashboardRoutes = require('./src/routes/dashboardRoutes');
const agendaRoutes = require('./src/routes/agendaRoutes');
const estadisticaRoutes = require('./src/routes/estadisticaRoutes');
const pacienteRoutes = require('./src/routes/pacienteRoutes');
const app = express();
const PORT = process.env.PORT || 3000;



app.use(cors({
  origin: 'http://localhost:3001',
  methods: ['GET', 'POST', 'PUT', 'DELETE'],
  credentials: true,
}));

app.use(express.json());
app.use(express.urlencoded({ extended: true }));

app.use('/api-docs', swaggerUi.serve, swaggerUi.setup(swaggerDocument));

app.get('/', (req, res) => {
  res.send('Server is running! Check /api-docs for documentation.');
});

app.use('/api/auth', authRoutes);
app.use('/api/citas', citaRoutes);
app.use('/api/fundaciones', fundacionRoutes);
app.use('/api/asignaciones', asignacionRoutes);
app.use('/api/sesiones', sesionRoutes);
app.use('/api/notificaciones', notificacionRoutes);
app.use('/api/altas', altaRoutes);
app.use('/api/reportes', reporteRoutes);
app.use('/api/observaciones', observacionRoutes);
app.use('/api/disponibilidad', disponibilidadRoutes);
app.use('/api/expedientes', expedienteRoutes);
app.use('/api/dashboard', dashboardRoutes);
app.use('/api/agenda', agendaRoutes);
app.use('/api/estadisticas', estadisticaRoutes);
const userRoutes = require('./src/routes/userRoutes');
app.use('/api/users', userRoutes);
app.use('/api/roles', roleRoutes);
app.use('/api/pacientes', pacienteRoutes);
// Sincronizar modelos
sequelize.sync({ force: false, alter: false })
    .then(() => {
        console.log("✅ Tablas sincronizadas (base de datos lista)");
        app.listen(PORT, () => {
          console.log(`Backend running on http://localhost:${PORT}`);
          console.log(`Swagger docs: http://localhost:${PORT}/api-docs`);
          console.log(`CORS permitido para: http://localhost:3001`);
          console.log(`Endpoints disponibles:`);
          console.log(`  GET  /api/citas/citas-por-fecha?fecha=YYYY-MM-DD&becario_id=1`);
          console.log(`  GET  /api/citas/reporte-mensual?mes=1&anio=2024`);
          console.log(`  POST /api/citas/alta-paciente`);
          console.log(`  PUT  /api/citas/cita/:id`);
        });
    })
    .catch((error) => {
        console.error("❌ Error al sincronizar la base de datos:", error.message);
    });


/backend/src/controllers/altaController.js:
--------------------------------------------------------------------------------
const Alta = require('../models/altaModel');
const Paciente = require('../models/pacienteModel');
const Cita = require('../models/citaModel');
const Asignacion = require('../models/asignacionModel');
const { QueryTypes, Op } = require('sequelize'); // AÑADE Op aquí
const sequelize = require('../config/db');

class AltaController {
    
    static async darAltaPaciente(req, res) {
        try {
            const { paciente_id, tipo_alta, motivo_detallado, recomendaciones, 
                    evaluacion_final, seguimiento_recomendado, fecha_seguimiento } = req.body;
            const usuarioId = req.user.id;
            
            // Verificar que el paciente existe y está activo
            const paciente = await Paciente.findByPk(paciente_id);
            
            if (!paciente || !paciente.activo) {
                return res.status(404).json({
                    success: false,
                    message: 'Paciente no encontrado o ya dado de alta'
                });
            }
            
            // Obtener estadísticas del paciente
            const [estadisticas] = await sequelize.query(`
                SELECT 
                    COUNT(*) as total_sesiones,
                    COUNT(CASE WHEN estado = 'completada' THEN 1 END) as sesiones_completadas,
                    MIN(fecha) as primera_sesion,
                    MAX(fecha) as ultima_sesion
                FROM citas 
                WHERE paciente_id = ?
                AND estado IN ('completada', 'cancelada')
            `, {
                replacements: [paciente_id],
                type: QueryTypes.SELECT
            });
            
            // Iniciar transacción
            const transaction = await sequelize.transaction();
            
            try {
                // 1. Registrar el alta
                const alta = await Alta.create({
                    paciente_id,
                    usuario_id: usuarioId,
                    tipo_alta,
                    fecha_alta: new Date().toISOString().split('T')[0],
                    motivo_detallado,
                    recomendaciones,
                    sesiones_totales: estadisticas?.sesiones_completadas || 0,
                    evaluacion_final,
                    seguimiento_recomendado,
                    fecha_seguimiento: seguimiento_recomendado ? fecha_seguimiento : null
                }, { transaction });
                
                // 2. Desactivar paciente
                await paciente.update({
                    activo: false,
                    estado: `alta_${tipo_alta}`,
                    updated_at: new Date()
                }, { transaction });
                
                // 3. Finalizar asignaciones activas
                await Asignacion.update({
                    estado: 'finalizada',
                    fecha_fin: new Date().toISOString().split('T')[0],
                    motivo_fin: `Paciente dado de alta (${tipo_alta})`
                }, {
                    where: { paciente_id, estado: 'activa' },
                    transaction
                });
                
                // 4. Cancelar citas futuras - VERSIÓN CORREGIDA
                const fechaHoy = new Date().toISOString().split('T')[0];
                
                await Cita.update({
                    estado: 'cancelada',
                    motivo_cancelacion: `Paciente dado de alta (${tipo_alta})`,
                    updated_at: new Date()
                }, {
                    where: {
                        paciente_id,
                        fecha: { [Op.gte]: fechaHoy },
                        estado: { [Op.in]: ['programada', 'confirmada'] }
                    },
                    transaction
                });
                
                // 5. Obtener profesionales asignados para notificaciones
                const [profesionales] = await sequelize.query(`
                    SELECT DISTINCT 
                        a.psicologo_id,
                        a.becario_id
                    FROM asignaciones a
                    WHERE a.paciente_id = ?
                    AND a.estado = 'activa'
                `, {
                    replacements: [paciente_id],
                    type: QueryTypes.SELECT,
                    transaction
                });
                
                // 6. Crear notificaciones
                if (profesionales) {
                    const notificaciones = [];
                    const titulo = 'Paciente dado de alta';
                    const mensaje = `El paciente ${paciente.nombre} ${paciente.apellido} ha sido dado de alta (${tipo_alta}).`;
                    
                    if (profesionales.psicologo_id) {
                        notificaciones.push([profesionales.psicologo_id, 'alerta_sistema', titulo, mensaje]);
                    }
                    
                    if (profesionales.becario_id) {
                        notificaciones.push([profesionales.becario_id, 'alerta_sistema', titulo, mensaje]);
                    }
                    
                    for (const [usuarioIdNotif, tipo, tituloNotif, mensajeNotif] of notificaciones) {
                        await sequelize.query(`
                            INSERT INTO notificaciones (usuario_id, tipo, titulo, mensaje, created_at)
                            VALUES (?, ?, ?, ?, NOW())
                        `, {
                            replacements: [usuarioIdNotif, tipo, tituloNotif, mensajeNotif],
                            transaction
                        });
                    }
                }
                
                // 7. Registrar log
                await sequelize.query(`
                    INSERT INTO logs_sistema (usuario_id, tipo_log, modulo, accion, descripcion, created_at)
                    VALUES (?, 'modificacion', 'altas', 'Dar de alta paciente', ?, NOW())
                `, {
                    replacements: [usuarioId, `Alta paciente ${paciente_id} - Tipo: ${tipo_alta}`],
                    transaction
                });
                
                // Commit transacción
                await transaction.commit();
                
                res.json({
                    success: true,
                    message: 'Paciente dado de alta exitosamente',
                    data: {
                        alta,
                        paciente: {
                            id: paciente.id,
                            nombre: paciente.nombre,
                            apellido: paciente.apellido,
                            estado: paciente.estado
                        },
                        estadisticas
                    }
                });
                
            } catch (error) {
                await transaction.rollback();
                console.error('Error en transacción de alta:', error);
                throw error;
            }
            
        } catch (error) {
            console.error('Error en darAltaPaciente:', error);
            res.status(500).json({
                success: false,
                message: 'Error al dar de alta paciente',
                error: error.message
            });
        }
    }
    
    static async obtenerAltas(req, res) {
        try {
            const { fecha_inicio, fecha_fin, tipo_alta, psicologo_id } = req.query;
            
            let query = `
                SELECT 
                    a.*,
                    p.nombre AS paciente_nombre,
                    p.apellido AS paciente_apellido,
                    p.telefono AS paciente_telefono,
                    u.nombre AS usuario_nombre,
                    u.apellido AS usuario_apellido,
                    COUNT(DISTINCT c.id) AS total_sesiones
                FROM altas a
                JOIN pacientes p ON a.paciente_id = p.id
                JOIN users u ON a.usuario_id = u.id
                LEFT JOIN citas c ON a.paciente_id = c.paciente_id AND c.estado = 'completada'
                WHERE 1=1
            `;
            
            const replacements = [];
            
            if (fecha_inicio) {
                query += ` AND a.fecha_alta >= ?`;
                replacements.push(fecha_inicio);
            }
            
            if (fecha_fin) {
                query += ` AND a.fecha_alta <= ?`;
                replacements.push(fecha_fin);
            }
            
            if (tipo_alta) {
                query += ` AND a.tipo_alta = ?`;
                replacements.push(tipo_alta);
            }
            
            if (psicologo_id) {
                query += ` AND EXISTS (
                    SELECT 1 FROM asignaciones asig 
                    WHERE asig.paciente_id = a.paciente_id 
                    AND asig.psicologo_id = ?
                    AND asig.estado = 'finalizada'
                )`;
                replacements.push(psicologo_id);
            }
            
            query += ` GROUP BY a.id, p.id, u.id
                      ORDER BY a.fecha_alta DESC, p.apellido, p.nombre`;
            
            const altas = await sequelize.query(query, {
                replacements,
                type: QueryTypes.SELECT
            });
            
            res.json({
                success: true,
                data: altas,
                count: altas.length
            });
            
        } catch (error) {
            console.error('Error en obtenerAltas:', error);
            res.status(500).json({
                success: false,
                message: 'Error al obtener altas'
            });
        }
    }
    
    static async obtenerAltaDetalle(req, res) {
        try {
            const { id } = req.params;
            
            const query = `
                SELECT 
                    a.*,
                    p.nombre AS paciente_nombre,
                    p.apellido AS paciente_apellido,
                    p.fecha_nacimiento,
                    p.genero,
                    p.email AS paciente_email,
                    p.telefono AS paciente_telefono,
                    u.nombre AS usuario_nombre,
                    u.apellido AS usuario_apellido,
                    u_psi.nombre AS psicologo_nombre,
                    u_psi.apellido AS psicologo_apellido,
                    (SELECT COUNT(*) FROM citas WHERE paciente_id = a.paciente_id AND estado = 'completada') AS total_sesiones,
                    (SELECT GROUP_CONCAT(DISTINCT DATE_FORMAT(fecha, '%Y-%m-%d') ORDER BY fecha DESC SEPARATOR ', ') 
                    FROM citas WHERE paciente_id = a.paciente_id AND estado = 'completada' LIMIT 10) AS ultimas_sesiones
                FROM altas a
                JOIN pacientes p ON a.paciente_id = p.id
                JOIN users u ON a.usuario_id = u.id
                LEFT JOIN (
                    SELECT paciente_id, psicologo_id 
                    FROM asignaciones 
                    WHERE paciente_id = ? 
                    ORDER BY fecha_inicio DESC 
                    LIMIT 1
                ) asig ON p.id = asig.paciente_id
                LEFT JOIN users u_psi ON asig.psicologo_id = u_psi.id
                WHERE a.id = ?
            `;
            
            const [alta] = await sequelize.query(query, {
                replacements: [id, id],
                type: QueryTypes.SELECT
            });
            
            if (!alta) {
                return res.status(404).json({
                    success: false,
                    message: 'Alta no encontrada'
                });
            }
            
            res.json({
                success: true,
                data: alta
            });
            
        } catch (error) {
            console.error('Error en obtenerAltaDetalle:', error);
            res.status(500).json({
                success: false,
                message: 'Error al obtener detalle de alta'
            });
        }
    }
    
    static async obtenerEstadisticasAltas(req, res) {
        try {
            const { fecha_inicio, fecha_fin } = req.query;
            
            let query = `
                SELECT 
                    tipo_alta,
                    COUNT(*) as total,
                    MONTH(fecha_alta) as mes,
                    YEAR(fecha_alta) as anio,
                    AVG(sesiones_totales) as promedio_sesiones,
                    SUM(CASE WHEN seguimiento_recomendado = TRUE THEN 1 ELSE 0 END) as seguimientos_recomendados
                FROM altas
                WHERE 1=1
            `;
            
            let replacements = [];
            
            if (fecha_inicio) {
                query += ` AND fecha_alta >= ?`;
                replacements.push(fecha_inicio);
            }
            
            if (fecha_fin) {
                query += ` AND fecha_alta <= ?`;
                replacements.push(fecha_fin);
            }
            
            query += ` GROUP BY tipo_alta, YEAR(fecha_alta), MONTH(fecha_alta)
                    ORDER BY anio DESC, mes DESC, total DESC`;
            
            const estadisticas = await sequelize.query(query, {
                replacements,
                type: QueryTypes.SELECT
            });
            
            // Totales generales - AQUÍ ESTABA EL ERROR PRINCIPAL
            // Crear la query para totales de forma dinámica
            let totalesQuery = `
                SELECT 
                    COUNT(*) as total_altas,
                    AVG(sesiones_totales) as promedio_sesiones_global,
                    MIN(fecha_alta) as primera_alta,
                    MAX(fecha_alta) as ultima_alta
                FROM altas
                WHERE 1=1
            `;
            
            let totalesReplacements = [];
            
            if (fecha_inicio) {
                totalesQuery += ` AND fecha_alta >= ?`;
                totalesReplacements.push(fecha_inicio);
            }
            
            if (fecha_fin) {
                totalesQuery += ` AND fecha_alta <= ?`;
                totalesReplacements.push(fecha_fin);
            }
            
            const [totales] = await sequelize.query(totalesQuery, {
                replacements: totalesReplacements,
                type: QueryTypes.SELECT
            });
            
            res.json({
                success: true,
                data: {
                    estadisticas,
                    totales
                }
            });
            
        } catch (error) {
            console.error('Error en obtenerEstadisticasAltas:', error);
            res.status(500).json({
                success: false,
                message: 'Error al obtener estadísticas de altas'
            });
        }
    }
    
    // Método auxiliar para verificar permisos
    static async verificarPermisoAlta(usuarioId, pacienteId) {
        const usuarioRol = await this.obtenerRolUsuario(usuarioId);
        
        if (usuarioRol === 'coordinador') return true;
        
        if (usuarioRol === 'psicologo') {
            const [asignacion] = await sequelize.query(`
                SELECT 1 FROM asignaciones 
                WHERE paciente_id = ? 
                AND psicologo_id = ?
                AND estado = 'activa'
            `, {
                replacements: [pacienteId, usuarioId],
                type: QueryTypes.SELECT
            });
            
            return !!asignacion;
        }
        
        return false;
    }
    
    static async obtenerRolUsuario(usuarioId) {
        const [usuario] = await sequelize.query(
            'SELECT rol FROM users WHERE id = ?',
            { replacements: [usuarioId], type: QueryTypes.SELECT }
        );
        
        return usuario?.rol;
    }
}

module.exports = AltaController;


/frontend/src/App.js:
--------------------------------------------------------------------------------
import React from 'react';
import { BrowserRouter as Router, Routes, Route, Navigate } from 'react-router-dom';
import { AuthProvider } from './context/AuthContext';
import Login from './components/Auth/Login';
import RoleRouter from './components/Auth/RoleRouter';
import ProtectedRoute from './components/Auth/ProtectedRoute';

// Importa los modales
import ConfirmModal from './components/Common/ConfirmModal';
import NotificationModal from './components/Common/NotificationModal';

// Páginas para Becarios
import BecarioDashboard from './pages/becario/DashboardPage';
import BecarioCitas from './pages/becario/CitasPage';
import BecarioPacientes from './pages/becario/PacientesPage';
import BecarioNotificaciones from './pages/becario/NotificacionesPage';
import BecarioObservaciones from './pages/becario/ObservacionesPage';

// Páginas para Psicólogos
import PsicologoDashboard from './pages/psicologo/DashboardPage';
import PsicologoPacientes from './pages/psicologo/PacientesPage';
import PsicologoCitas from './pages/psicologo/CitasPage';
import PsicologoExpedientes from './pages/psicologo/ExpedientesPage';
import PsicologoSesiones from './pages/psicologo/SesionesPage';
import PsicologoSupervision from './pages/psicologo/SupervisionPage';

// Páginas para Coordinadores
import CoordinadorDashboard from './pages/coordinador/DashboardPage';
import CoordinadorUsuarios from './pages/coordinador/UsuariosPage';
import CoordinadorPacientes from './pages/coordinador/PacientesPage';
import CoordinadorAsignaciones from './pages/coordinador/AsignacionesPage';
import CoordinadorAgenda from './pages/coordinador/AgendaPage';
import CoordinadorReportes from './pages/coordinador/ReportesPage';
import CoordinadorAltas from './pages/coordinador/AltasPage';
import CoordinadorConfiguracion from './pages/coordinador/ConfiguracionPage';

function App() {
  return (
    <Router>
      <AuthProvider>
        {/* Agrega los modales aquí */}
        <ConfirmModal />
        <NotificationModal />
        
        <Routes>
          <Route path="/login" element={<Login />} />
          
          {/* Rutas de Becario */}
          <Route path="/" element={<RoleRouter />}>
            <Route index element={<BecarioDashboard />} />
            
            {/* Becario */}
            <Route path="becario/dashboard" element={<BecarioDashboard />} />
            <Route path="becario/citas" element={<BecarioCitas />} />
            <Route path="becario/pacientes" element={<BecarioPacientes />} />
            <Route path="becario/notificaciones" element={<BecarioNotificaciones />} />
            <Route path="becario/observaciones" element={<BecarioObservaciones />} />
            
            {/* Psicólogo */}
            <Route path="psicologo/dashboard" element={<PsicologoDashboard />} />
            <Route path="psicologo/pacientes" element={<PsicologoPacientes />} />
            <Route path="psicologo/citas" element={<PsicologoCitas />} />
            <Route path="psicologo/expedientes" element={<PsicologoExpedientes />} />
            <Route path="psicologo/sesiones" element={<PsicologoSesiones />} />
            <Route path="psicologo/supervision" element={<PsicologoSupervision />} />
            
            {/* Coordinador */}
            <Route path="coordinador/dashboard" element={<CoordinadorDashboard />} />
            <Route path="coordinador/usuarios" element={<CoordinadorUsuarios />} />
            <Route path="coordinador/pacientes" element={<CoordinadorPacientes />} />
            <Route path="coordinador/asignaciones" element={<CoordinadorAsignaciones />} />
            <Route path="coordinador/agenda" element={<CoordinadorAgenda />} />
            <Route path="coordinador/reportes" element={<CoordinadorReportes />} />
            <Route path="coordinador/altas" element={<CoordinadorAltas />} />
            <Route path="coordinador/configuracion" element={<CoordinadorConfiguracion />} />
          </Route>
          
          {/* Redirección por defecto */}
          <Route path="*" element={<Navigate to="/" />} />
        </Routes>
      </AuthProvider>
    </Router>
  );
}

export default App;


================================================================================
RESUMEN PARA COORDINADOR_ALTAS:
----------------------------------------
Archivos necesarios: 11
Archivos encontrados: 11
Archivos no encontrados: 0
